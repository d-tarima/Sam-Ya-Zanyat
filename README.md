# Сам Я Занят

Цифровой сервис / Telegram-бот для самозанятых.

Коллеги, этот репозиторий — общий для всей команды.  
Здесь пока минимальная структура. При расширении и выходе на прод обновим, раскидаем.

---

## 0. Структура репозитория

```text
Sam-Ya-Zanyat/
├─ backend/
│  └─ app/
│     └─ main.py            # текущий код бота
│
├─ db/
│  └─ schema.sql            # дамп базы PostgreSQL (self_employed_db_dump.sql)
│
├─ docs/
│  └─ README-dev.md         # доп. заметки, планы, схемы (можно расширять)
│
├─ infra/
│  └─ docker-compose.yml    # заготовка под инфраструктуру (пока не используем)
│
├─ .gitignore               # список файлов/папок, которые не попадают в git
└─ README.md                # этот файл
```

> ⚠️ Важно: **ни реальные дампы БД, ни `.env` с токенами в Git НЕ выкладываем.**  
> В репозитории только код и SQL-схема, но не пользовательские данные.

---

## 1. Что нужно установить ОДИН раз

Ниже инструкция для **Windows**.  

### 1.1. Установить Git

1. Зайти на сайт: <https://git-scm.com/downloads>  
2. Скачать версию для **Windows**.  
3. Запустить установщик → везде жать **Next**.  
4. После установки:
   - нажать **Win** → в поиске ввести `PowerShell`;
   - открыть **Windows PowerShell**;
   - ввести команду:

   ```bash
   git --version
   ```

   Если видите что-то вроде `git version 2.xx.x` — Git установлен.

---

### 1.2. Установить Python 

1. Сайт: <https://www.python.org/downloads/>  
2. Скачать **Python 3.12.2 для Windows**.  
3. **ВАЖНО:** при установке поставить галочку **“Add Python to PATH”**.  
4. После установки в PowerShell выполнить:

   ```bash
   python --version
   ```

   Должно показать `python 3.12.2`.

> Если Python уже стоит и команда показывает версию 3.x — этот пункт можно скипнуть.

---

### 1.3. Установить PostgreSQL

1. Сайт: <https://www.postgresql.org/download/>  
2. Выбрать **Windows → Download the installer**.  
3. В установщике:
   - оставить порт по умолчанию: `5432`;
   - придумать пароль для пользователя `postgres` и **запомнить его**;
   - установить вместе с **pgAdmin** (по умолчанию включён).

После установки у вас есть:

- сервер PostgreSQL локально;
- пользователь `postgres`;
- пароль, который вы задали;
- утилита `psql` и pgAdmin.

---

### 1.4. Редактор кода

Можно использовать любой, хоть блокнот

---

## 2. Как скачать проект первый раз

1. Открыть **PowerShell** (Win → поиск → “PowerShell”).  
2. Перейти в папку, где хотите хранить проекты, например:

   ```bash
   cd C:\CYZ
   ```

3. Клонировать репозиторий:

   ```bash
   git clone https://github.com/d-tarima/Sam-Ya-Zanyat.git
   cd Sam-Ya-Zanyat
   ```

4. В этой папке вы увидите структуру из раздела **0**.

---

## 3. Работа с Git: общий рабочий поток

Сейчас работаем **напрямую в ветке `main`** (ветки/PR введём позже, если будет страх всё положить в минус).

### 3.1. Перед началом работы

Всегда сначала подтягиваем свежие изменения:

```bash
cd C:\CYZ\Sam-Ya-Zanyat
git pull
```

Это важно, чтобы не затирать чужие изменения.

---

### 3.2. После того как что-то сделали

1. Проверить, что изменилось:

   ```bash
   git status
   ```

2. Добавить изменённые файлы в коммит:

   - точечно (пример):

     ```bash
     git add backend/app/main.py
     ```

   - или сразу всё (осторожно пацаны!):

     ```bash
     git add .
     ```

3. Создать коммит с внятным комментарием (ОБЯЗАТЕЛЬНО, чтобы коммуникация была лучше):

   ```bash
   git commit -m "Кратко: что изменили (например, add income command)"
   ```

4. Отправить изменения в GitHub:

   ```bash
   git push
   ```
Обновляем в браузере страницу с репозиторией через пару минут, чекаем что всё улетело (+ powershell выдаст инфу об обновлении)
---

### 3.3. Если Git ругается при `git push`

Чаще всего он просит сначала сделать `git pull`, потому что кто-то уже залил изменения.

Тогда:

```bash
git pull
# если спросит про merge/конфликты — смотрим, что пишет,
# в сложных случаях зовём зовём Костяна и молимся всей командой (даже Костян)
git push
```

---

### 3.4. Что НЕЛЬЗЯ пушить

**НЕ добавляем в git (`git add`) и не коммитим:**

- папки виртуальных окружений: `venv/`, `.venv/`, `env/`;  
- папки `__pycache__/` и прочие временные файлы;  
- `.idea/`, `.vscode/`, `.DS_Store`;  
- файлы `.env` с токенами и паролями;  
- дампы базы (`*.sql`), кроме **официального** `db/schema.sql`, который ведёт Андрей

Часть этого уже спрятана через `.gitignore`, но руками тоже следим.

---

## 4. Как поднять локальную базу данных из дампа

Сейчас база описана дампом:

```text
db/schema.sql
```

### 4.1. Создать пустую базу `samya`

Открываем **SQL Shell (psql)** (идёт в комплекте с PostgreSQL):

1. Пуск → поиск → `SQL Shell (psql)` → открыть.  
2. На вопросы можно просто нажимать Enter, кроме пароля:
   - `Server`: `localhost`
   - `Database`: `postgres`
   - `Port`: `5432`
   - `Username`: `postgres`
   - `Password`: вписать пароль, заданный при установке PostgreSQL.
3. После подключения ввести:

   ```sql
   CREATE DATABASE samya;
   ```

4. Выйти из psql:

   ```sql
   \q
   ```

---

### 4.2. Залить дамп `schema.sql` в эту базу

1. Убедиться, что вы в корне проекта:

   ```bash
   cd C:\CYZ\Sam-Ya-Zanyat
   ```

2. Выполнить команду:

   ```bash
   psql -U postgres -h localhost -d samya -f db/schema.sql
   ```

3. Ввести пароль пользователя `postgres`, если запросит.

После этого в базе `samya` появятся все таблицы и тестовые данные, которые подготовил Dev2.

> Если имя пользователя у вас не `postgres` — замените его в команде.

---

## 5. Как запускать бота / backend локально

На текущем этапе весь код бота находится **в одном файле**:

```text
backend/app/main.py
```

> ⚠️ Конкретные команды запуска могут отличаться в зависимости от того, как Саня напишет код.  
> Ниже — базовый вариант. Если точка входа будет другой (например, `runner.py`), Саня обязан дописать сюда правильную команду.

---

### 5.1. Виртуальное окружение (рекомендуется)

1. Из корня проекта:

   ```bash
   cd C:\CYZ\Sam-Ya-Zanyat
   python -m venv venv
   ```

2. Активировать окружение:

   ```bash
   venv\Scripts\activate
   ```

3. Когда появится файл `requirements.txt` или `pyproject.toml`, установить зависимости, например:

   ```bash
   pip install -r requirements.txt
   ```

Сейчас, если зависимостей немного, Саня может ставить их вручную:

```bash
pip install aiogram fastapi psycopg2-binary
```

и позже зафиксировать в `requirements.txt`.

---

### 5.2. Запуск бота (базовый вариант)

```bash
cd C:\CYZ\Sam-Ya-Zanyat  #ДИРЕКТОРИЯ С ПРОЕКТОМ, КОТОРАЯ У ВАС
venv\Scripts\activate          # если используется виртуальное окружение
python backend/app/main.py
```

Если Саня сделает запуск по-другому (например, `python -m backend.app.main` или через `runner.py`) — **обязательно** нужно обновить этот раздел README (разберёмся по ситуации).

---

### 5.3. Переменные окружения

Секреты (токен бота, строка подключения к базе) **нельзя хранить в коде** (знаем и без меня).

Обычно создаётся файл `.env` в корне проекта (который **НЕ** попадает в git) с чем-то вроде:

```dotenv
BOT_TOKEN=сюда_токен_бота_от_BotFather
DATABASE_URL=postgresql://postgres:пароль@localhost/samya
```

Сами названия переменных (`BOT_TOKEN`, `DATABASE_URL` и т.п.) должен определить Саня при написании конфига бота

---

## 6. Docker и infra (на будущее Костяну)

На Этапе 0:

- **Docker НЕ обязателен.**  
- Файл `infra/docker-compose.yml` — просто заготовка.  
- VPS для проекта будет использоваться только под этот бот, поэтому докеризацию и деплой сделаем позже.

Когда придёт время:

1. В `infra/docker-compose.yml` опишем:
   - сервис `api` (backend),
   - сервис `db` (PostgreSQL),
   - сервис `redis` (если понадобится).
2. Настроим сборку образов.
3. Настроим деплой на сервер.

**СЕЙЧАС никаких Docker-команд запускать не нужно.**  
Работаем напрямую: **Python + локальный PostgreSQL на ноуте Сани**.

---

## 7. Если что-то идёт не так с запуском, гитом или деплоем

При любой непонятной ошибке пишем ЧТО ДЕЛАЛИ, В КАКОЙ ДИРЕКТОРИИ БЫЛИ и ПОЛНЫЙ ТЕКСТ ОШИБКИ

---

## 8. Кратко по ролям

- **Саня (бот)**  
  - пишет код в `backend/app/main.py` (и позже сам разнесёт по модулям, если захочет);  
  - описывает, как запускать бота (обновляет раздел 5 README).

- **Андрюха (база)**  
  - ведёт `db/schema.sql`;  
  - позже — отвечает за миграции (Alembic), когда будем переходить к ним.

- **Костян (инфра)**  
  - следит за структурой репозитория;  
  - помогает с Git, конфликтами, ветками(в будущем, пока всё будет в main);  
  - отвечает за Docker/infra и деплой на сервер;  
  - поддерживает актуальность `README.md` и `docs/`.


